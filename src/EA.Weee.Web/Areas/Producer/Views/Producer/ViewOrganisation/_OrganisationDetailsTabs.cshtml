@using EA.Weee.Web.RazorHelpers
@using MvcNavigationHelpers

@using EA.Weee.Web.Areas.Admin.ViewModels.Scheme.Overview
@using EA.Weee.Web.RazorHelpers
@using MvcNavigationHelpers
@using EA.Weee.Web.Areas.Producer.Controllers
@using EA.Weee.Web.Areas.Producer.ViewModels
@using EA.Prsd.Core.Web.Mvc.RazorHelpers
@using EA.Weee.Core.Helpers

@model OrganisationDetailsTabsViewModel

@{
    var hasYear = Model.Year != null;

    var @title = hasYear ? "Producer registration submissions" : "View organisation details";
}

@(this.WeeeGds()
        .BackLink(@Url.UrlFor<EA.Weee.Web.Areas.Scheme.Controllers.HomeController>(a => a.ChooseActivity(Model.SmallProducerSubmissionData.OrganisationData.Id))))

<header class="hgroup">
    <h1 class="govuk-heading-l">@title</h1>
</header>


@using (Html.BeginForm("OrganisationDetails", typeof(ProducerController).GetControllerName(), FormMethod.Get))
{

    <fieldset class="govuk-fieldset">
        <legend class="govuk-visually-hidden">
            select year
        </legend>
        <div class="govuk-grid-row">

            <div class="govuk-form-group govuk-grid-column-one-half @Html.Gds().FormGroupClass(m => m.Year)">
                <div class="font-bold govuk-body govuk-!-display-inline govuk-!-font-weight-bold">@Html.LabelFor(m => m.Year, new { @for = "ReturnsExternalSelectedComplianceYear" }):&nbsp;&nbsp;</div>
                @Html.Gds().ValidationMessageFor(m => m.Year)
                <div class="govuk-!-width-full govuk-!-display-inline">
                    @Html.Gds().DropDownListFor(m => m.Year, new SelectList(Model.Years), new { id = "year-dropdown" })
                </div>
            </div>

            <noscript>
                <button class="govuk-button" data-module="govuk-button" type="submit" data-prevent-double-click="true">Select</button>
            </noscript>
            <div class="govuk-!-padding-bottom-5"></div>
        </div>

    </fieldset>

}

@if (hasYear)
{
    <div class="govuk-form-group @Html.Gds().FormGroupClass(m => m.Year)">
        @Html.Gds().LabelFor(m => m.Year, new { @class = "govuk-label--s" })
        @Html.Gds().ValidationMessageFor(m => m.Year)
        @Html.Gds().DropDownListFor(m => m.Year, new SelectList(Model.Years), string.Empty, new { id = "year-dropdown" }, useHalfWidth: false, withLookAhead: false)
    </div>

    <p>If this information is not correct, please contact your agency and they will be able to return your application to you.</p>
}

<ul class="govuk-tabs__list" role="tablist">
    @this.WeeeGds().Tab("View organisation",
    Url.UrlFor<ProducerController>(a => a.OrganisationDetails(Model.Year)),
    Model.ActiveOption == OrganisationDetailsDisplayOption.OrganisationDetails, "organisationDetailsAnchor")

    @this.WeeeGds().Tab("Contact details",
    Url.UrlFor<ProducerController>(a => a.ContactDetails(Model.Year)),
    Model.ActiveOption == OrganisationDetailsDisplayOption.ContactDetails, "contactDetailsAnchor")

    @this.WeeeGds().Tab("Service of notice details",
    Url.UrlFor<ProducerController>(a => a.ServiceOfNoticeDetails(Model.Year)),
    Model.ActiveOption == OrganisationDetailsDisplayOption.ServiceOfNoticeDetails, "serviceOfNoticeDetailsAnchor")

    @if (@Model.SmallProducerSubmissionData.HasAuthorisedRepresentitive && hasYear)
    {
        <span>
            @this.WeeeGds().Tab("Represented organisation details",
            Url.UrlFor<ProducerController>(a => a.RepresentedOrganisationDetails(Model.Year)),
            Model.ActiveOption == OrganisationDetailsDisplayOption.RepresentedOrganisationDetails, "representedOrganisationDetailsAnchor")
        </span>
    }

    @if (hasYear)
    {
        <span>
            @this.WeeeGds().Tab("Total EEE",
              Url.UrlFor<ProducerController>(a => a.TotalEEEDetails(Model.Year)),
              Model.ActiveOption == OrganisationDetailsDisplayOption.TotalEEEDetails, "totalEEEDetailsAnchor")
        </span>
    }
</ul>

@if (hasYear)
{
    <style>
        .govuk-tabs__tab:link, .govuk-tabs__tab:visited {
            font-size: 17px;
        }
    </style>

    
}

@*<script>
    document.addEventListener("DOMContentLoaded", () => {
        $(() => {
            let onChange = function () {
                let currentUrl = new URL(window.location.href);
                currentUrl.searchParams.set("year", $(this).val());
                history.pushState(null, '', currentUrl);

                document.location = currentUrl;
            };

            $("#year-dropdown").change(onChange);
        });
    });
</script>*@