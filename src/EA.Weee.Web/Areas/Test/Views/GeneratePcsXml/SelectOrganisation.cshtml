@using EA.Prsd.Core.Web.Mvc.RazorHelpers
@model EA.Weee.Web.Areas.Test.ViewModels.GeneratePcsXml.SelectOrganisationViewModel

@{
    ViewBag.Title = "Select Organisation";
}

@section main_content
{
    <header class="hgroup">
        <h1 class="heading-large">
            Select a PCS
        </h1>
    </header>

    @using (Html.BeginForm("SelectOrganisation", "GeneratePcsXml", FormMethod.Get))
    {
        @Html.AntiForgeryToken()
        
        <p>Search for and select the PCS that will be used for the test file.</p>

        @Html.ValidationSummary()
        
        <div class="form-group" id="companyName">
            @Html.Gds().LabelFor(m => m.OrganisationName)
            @Html.Gds().ValidationMessageFor(m => m.OrganisationName)
            @Html.Gds().TextBoxFor(m => m.OrganisationName)
        </div>

        <div class="form-group">
            <input type="submit" class="button" value="Search" />
        </div>
    }

    @if (Model.MatchingOrganisations != null)
    {
    <hr />

        if (Model.MatchingOrganisations.Count > 0)
        {
            <p>We have found some organisations that match the information you have provided.</p>

            for (int i = 0; i < Model.MatchingOrganisations.Count; i++)
            {
                bool isNewRow = (i % 2 == 0);

                if (isNewRow)
                {
                    @:<div class="grid-row">
                }

                <div class="column-half">
                    
                    <h3 class="heading-small"></h3>
                    
                    <div class="colored-header-bar"></div>
                    
                    <ul>
                        <li>
                            <span class="bold-small">@Html.DisplayFor(m => m.MatchingOrganisations[i].DisplayName)</span>
                        </li>
                        <li>
                            @Html.DisplayFor(m => m.MatchingOrganisations[i].Address.Address1),
                        </li>
                        <li>
                            @Html.DisplayFor(m => m.MatchingOrganisations[i].Address.TownOrCity),
                        </li>
                        <li>
                            @Html.DisplayFor(m => m.MatchingOrganisations[i].Address.Postcode)
                        </li>
                    </ul>

                    @Html.ActionLink("Select this organisation", "SpecifyOptions", new { OrganisationID = Model.MatchingOrganisations[i].Id })
                        
                </div>

                if (!isNewRow || i == Model.MatchingOrganisations.Count - 1)
                {
                    @:</div>
                }
            }
            
            <br />
            
            @Html.Partial("_WeeePaging", Model.PagingViewModel)
        }
        else
        {
            <p>We haven't found any organisations that match your search criteria.</p>
        }
    }
}


