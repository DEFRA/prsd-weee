@using EA.Weee.Core.Shared
@using EA.Weee.Web.RazorHelpers
@model EA.Weee.Web.Areas.Scheme.ViewModels.MemberUploadResultViewModel
@{
    ViewBag.Title = "View errors and warnings";
}

@section main_content {

    <header class="hgroup">
        <div>
            @{
                int numOfErrors = @Model.ErrorData.Count(e => e.ErrorLevel == ErrorLevel.Error || e.ErrorLevel == ErrorLevel.Fatal);
                int numWarnings = Model.ErrorData.Count(e => e.ErrorLevel == ErrorLevel.Warning);
                string errorText = (numOfErrors > 1 ? "errors" : "error");
                string warningText = (numWarnings > 1 ? "warnings" : "warning");
            }

            @if (numWarnings > 0)
            {
                <h1 class="heading-large">
                    Your XML file contains @numOfErrors @errorText and @numWarnings @warningText
                </h1>
            }
            else
            {
                <h1 class="heading-large">
                    Your XML file contains @numOfErrors @errorText
                </h1>
            }
        </div>
    </header>
    <h2 class="heading-medium">You must rectify all errors in order to successfully upload your file.</h2>
    <p>
        Errors are problems with the XML file structure and content, which prevent our system from validating your file. Some errors must be rectified before we can continue our validation process. You may see several error screens before your file is accepted.
    </p>

    @if (numWarnings > 0)
    {
        <p>
            Warnings are displayed where member details are changed. You must review all the warnings in your XML file. Please make any necessary corrections to it before trying to submit it again. Or, if the changes are valid, you can submit your XML file as it is, with warnings.
        </p>
    }

    <details>
        <summary class="error-details-summary bold-small">View @numOfErrors @errorText</summary>
        <div class="error-list-container">
            <ul>
                @foreach (var uploadError in Model.ErrorData)
                {
                    if (uploadError.ErrorLevel == ErrorLevel.Error || uploadError.ErrorLevel == ErrorLevel.Fatal)
                    {
                        <li class="error-list-item font-xsmall">@uploadError.Description</li>
                    }
                }
            </ul>
        </div>
    </details>

    @if (numWarnings > 0)
    {
        <details>
            <summary class="warning-details-summary bold-small">View @numWarnings @warningText</summary>
            <div class="warning-list-container">
                <ul>
                    @foreach (var uploadError in Model.ErrorData)
                    {
                        if (uploadError.ErrorLevel == ErrorLevel.Warning)
                        {
                            <li class="warning-list-item font-xsmall">@uploadError.Description</li>
                        }
                    }
                </ul>
            </div>
        </details>
    }

    <p>
        To see your XML file’s full list,
        @this.WeeeGds().ActionLinkWithEventTracking("download your errors and warnings", "DownloadErrorsAndWarnings", "MemberRegistration",
            "Downloads", "Errors and warnings", routeValues: new RouteValueDictionary(new { memberUploadId = Model.MemberUploadId })).
    </p>

    <p>
        @this.WeeeGds().ActionLinkWithEventTracking("Upload a new file", "AddOrAmendMembers", "MemberRegistration",
             "Member registration loop", "Upload a new file", "Validation failed", null, new Dictionary<string, object>{{ "class", "button" }})
    </p>

    <div>
        @Html.ActionLink("Perform another activity", "ChooseActivity", "Home")
    </div>
}
