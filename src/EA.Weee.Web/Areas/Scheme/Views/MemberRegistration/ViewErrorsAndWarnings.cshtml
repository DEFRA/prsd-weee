@using EA.Weee.Core.Shared
@model EA.Weee.Web.Areas.Scheme.ViewModels.MemberUploadResultViewModel
@{
    ViewBag.Title = "View errors and warnings";
}

@section main_content {

    <header class="hgroup">
        <div>
            @{
                int numOfErrors = @Model.ErrorData.Count(e => e.ErrorLevel == ErrorLevel.Error || e.ErrorLevel == ErrorLevel.Fatal);
                int numWarnings = Model.ErrorData.Count(e => e.ErrorLevel == ErrorLevel.Warning);
                string errorText = (numOfErrors > 1 ? "errors" : "error");
                string warningText = (numWarnings > 1 ? "warnings" : "warning");
            }

            @if (numWarnings > 0)
            {
                <h1 class="heading-large">
                    Your XML file contains @numOfErrors @errorText and @numWarnings @warningText
                </h1>
            }
            else
            {
                <h1 class="heading-large">
                    Your XML file contains @numOfErrors @errorText
                </h1>
            }
        </div>
    </header>

    <p>
        Errors are problems with the XML file structure and formatting. They stop it from being uploaded successfully.
        You must rectify all errors in order to proceed and upload the file.
    </p>

    @if (numWarnings > 0)
    {
        <p>
            Warnings get displayed where member details are changed. You must review all the warnings in your XML file.
            Please make any necessary corrections to it before trying to submit it again.
            Or, if the changes are valid, you can submit your XML file as it is, with warnings.
        </p>
    }

    <p>
        <details class="errors">
            <summary>
                <span class="summary">View @numOfErrors @errorText</span>
            </summary>
            <div class="panel-indent">
                <ul>
                    @foreach (var uploadError in Model.ErrorData)
                    {
                        if (uploadError.ErrorLevel == ErrorLevel.Error || uploadError.ErrorLevel == ErrorLevel.Fatal)
                        {
                            <li>@uploadError.Description</li>
                        }
                    }
                </ul>
            </div>
        </details>
    </p>

    @if (numWarnings > 0)
    {
        <p>
            <details class="warnings">
                <summary>
                    <span class="summary">View @numWarnings @warningText</span>
                </summary>
                <div class="panel-indent">
                    <ul>
                        @foreach (var uploadError in Model.ErrorData)
                        {
                            if (uploadError.ErrorLevel == ErrorLevel.Warning)
                            {
                                <li>@uploadError.Description</li>
                            }
                        }
                    </ul>
                </div>
            </details>
        </p>
    }
    
    <p>
        To see your XML file’s full list, <a href="@Url.Action("DownloadErrorsAndWarnings", new { Model.MemberUploadId })">download your errors and warnings</a>.
    </p>

    <p>
        @Html.ActionLink("Upload a new file", "AddOrAmendMembers", "MemberRegistration", null, new { @class = "button" })
    </p>

    <div>
        @Html.ActionLink("Perform another activity", "ChooseActivity", "Home")
    </div>
}
