@using EA.Weee.Core.Organisations
@using EA.Weee.Web.Infrastructure.Paging
@model EA.Weee.Web.ViewModels.JoinOrganisation.SelectOrganisationViewModel
@{
    ViewBag.Title = "Choose your organisation";
}

@section main_content
{
    <header class="hgroup">
        <h1 class="heading-large">
            Choose to join an existing organisation, or add a new one
        </h1>
    </header>
    @*@HttpUtility.UrlPathEncode()*@
    @if (Model.MatchingOrganisations != null && Model.MatchingOrganisations.TotalItemCount > 0)
    {
        <p class="lede">We have found some organisations that match the information you have provided. Select your organisation or add it, if it is not listed.</p>

        int i = 0;
        foreach (OrganisationSearchData organisation in Model.MatchingOrganisations)
        {
            bool isNewRow = i % 2 == 0;

            if (isNewRow)
            {
                @:<div class="grid-row">
            }

            <div class="column-half">
                <h3 class="heading-small"></h3>
                <div class="colored-header-bar"></div>
                <ul>
                    <li>
                        <span class="bold-small">@Html.DisplayFor(m => organisation.DisplayName)</span>
                    </li>
                    <li>
                        @Html.DisplayFor(m => organisation.Address.Address1),
                    </li>
                    <li>
                        @Html.DisplayFor(m => organisation.Address.TownOrCity),
                    </li>
                    <li>
                        @Html.DisplayFor(m => organisation.Address.Postcode)
                    </li>
                </ul>
                @Html.ActionLink("Request to join this organisation", "JoinOrganisation", new { OrganisationID = organisation.Id })
            </div>

            if (!isNewRow || i == Model.MatchingOrganisations.Count() - 1)
            {
                @:</div>
            }
            i++;
        }

        <div>
            @if (@Model.MatchingOrganisations.PageCount > 1)
            {
                <br />
                <span style="display: inline-block">Showing @Model.MatchingOrganisations.ItemStart - @Model.MatchingOrganisations.ItemEnd of @Model.MatchingOrganisations.TotalItemCount</span>
                <div class="pager">
                    @Html.Pager(Model.MatchingOrganisations.PageSize, Model.MatchingOrganisations.PageNumber, Model.MatchingOrganisations.TotalItemCount).Options(o => o.RouteValues(@Model))
                </div>
                <br />
            }
        </div>
    }
    else
    {
        <p>We haven't found any organisations that match your search criteria. If you are expecting to see your organisation, you can go back and search again, otherwise you can add a new one.</p>
    }
    <br />
    <hr />
    <p>Organisation not listed?</p>

    @using (Html.BeginForm("CreateOrganisation", "OrganisationRegistration"))
    {
        @Html.AntiForgeryToken()

        @Html.HiddenFor(m => m.Name)
        @Html.HiddenFor(m => m.TradingName)
        @Html.HiddenFor(m => m.CompaniesRegistrationNumber)
        @Html.HiddenFor(m => m.Type)
        @Html.HiddenFor(m => m.OrganisationId)

        <button type="submit" name="submitButton" class="button">Add new</button>
    }
}