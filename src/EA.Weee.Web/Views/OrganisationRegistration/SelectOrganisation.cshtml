@using EA.Weee.Core.Organisations
@using EA.Weee.Web.Infrastructure.Paging
@model EA.Weee.Web.ViewModels.JoinOrganisation.SelectOrganisationViewModel
@{
    ViewBag.Title = "Choose your organisation";
}

@section main_content
{
    <header class="hgroup">
        <h1 class="heading-large">
            Choose to join an existing organisation, or add a new one
        </h1>
    </header>
    @if (Model.MatchingOrganisations != null && Model.MatchingOrganisations.TotalItemCount > 0)
    {
        <p class="lede">We have found some organisations that match the information you have provided. Select your organisation or add it, if it is not listed.</p>

        using (Html.BeginForm(actionName: "SelectOrganisation", controllerName: "OrganisationRegistration", method: FormMethod.Post))
        {
            @Html.AntiForgeryToken()
            @Html.ValidationMessageFor(m => m.Selected)
            @Html.HiddenFor(m => m.Name)
            @Html.HiddenFor(m => m.TradingName)
            @Html.HiddenFor(m => m.CompaniesRegistrationNumber)
            @Html.HiddenFor(m => m.Type)

            int i = 0;
            foreach (OrganisationSearchData organisation in Model.MatchingOrganisations)
            {
                bool isNewRow = i % 2 == 0;

                if (isNewRow)
                {
                    @:<div class="grid-row">
                }

                <div class="column-half">
                    <h3 class="heading-small"></h3>
                    <div class="colored-header-bar"></div>
                    <ul>
                        <li>
                            @Html.HiddenFor(m => organisation.DisplayName)
                            <span class="bold-small">@Html.DisplayFor(m => organisation.DisplayName)</span>
                        </li>
                        <li>
                            @Html.Hidden(organisation.Address.Address1)
                           @Html.DisplayFor(m => organisation.Address.Address1),
                        </li>
                        <li>
                            @Html.HiddenFor(m => organisation.Address.TownOrCity)
                            @Html.DisplayFor(m => organisation.Address.TownOrCity),
                        </li>
                        <li>
                            @Html.HiddenFor(m => organisation.Address.Postcode)
                            @Html.DisplayFor(m => organisation.Address.Postcode)
                        </li>
                    </ul>
                    <button type="submit" name="submitButton" value="@Html.Raw(organisation.Id)" class="link-submit">Request to join this organisation</button>
                </div>

                if (!isNewRow || i == Model.MatchingOrganisations.TotalItemCount - 1)
                {
                    @:</div>
                }
                i++;
            }
        }
        <div>
            @if (@Model.MatchingOrganisations.PageCount > 1)
            {
            <br />
            <p style="float:left">Showing @Model.MatchingOrganisations.ItemStart - @Model.MatchingOrganisations.ItemEnd of @Model.MatchingOrganisations.TotalItemCount</p>
            <div class="pager">

                @Html.Pager(Model.MatchingOrganisations.PageSize, Model.MatchingOrganisations.PageNumber, Model.MatchingOrganisations.TotalItemCount).Options(o => o.RouteValues(@Model))

            </div>
            <br />
            }
        </div>
    }
    else
    {
        <p>We haven't found any organisations that match your search criteria. If you are expecting to see your organisation, you can go back and search again, otherwise you can add a new one.</p>
    }
    <br/>
    <hr />
    <p>Organisation not listed?</p>

    @using (Html.BeginForm(actionName: "CreateOrganisation", controllerName: "OrganisationRegistration", method: FormMethod.Post))
    {
        @Html.AntiForgeryToken()

        @Html.HiddenFor(m => m.Name)
        @Html.HiddenFor(m => m.TradingName)
        @Html.HiddenFor(m => m.CompaniesRegistrationNumber)
        @Html.HiddenFor(m => m.Type)
        @Html.HiddenFor(m => m.OrganisationId)

        <button type="submit" name="submitButton" class="button">Add new</button>
    }
}